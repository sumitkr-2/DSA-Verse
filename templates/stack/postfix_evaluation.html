<!DOCTYPE html>
<html>
<head>
	<title>Postfix Evaluation - DSA Verse</title>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
	
	<style>
		:root {
			--primary-color: #4ade80;
			--dark-bg: #111827;
			--light-dark-bg: #1f2937;
			--card-bg: rgba(31, 41, 55, 0.5);
			--text-color: #e5e7eb;
			--border-color: rgba(255, 255, 255, 0.1);
			--scan-color: #facc15; /* Yellow for scanning */
		}
		* { margin: 0; padding: 0; box-sizing: border-box; }
		html { scroll-behavior: smooth; }
		body {
			font-family: 'Poppins', sans-serif;
			background: linear-gradient(135deg, var(--light-dark-bg), var(--dark-bg));
			color: var(--text-color);
			min-height: 100vh;
			overflow: hidden;
			text-align: center;
		}

		#main-content {
			padding: 3rem 1.5rem;
			max-width: 1050px;
			margin: 0 auto;
		}
		.page-header {
			text-align: center;
			margin-bottom: 2.5rem;
		}
		.back-link { text-decoration: none; }
		.heading {
			font-weight: 700;
			font-size: clamp(2.5rem, 5vw, 3.5rem);
			color: #fff;
			text-shadow: 0 0 15px rgba(74, 222, 128, 0.6);
			transition: transform 0.3s ease;
		}
		.back-link:hover .heading { transform: scale(1.05); }

		.canvas-container {
			background: var(--card-bg);
			backdrop-filter: blur(10px);
			border: 1px solid var(--border-color);
			border-radius: 16px;
			padding: 1rem;
			box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
			margin-bottom: 2rem;
		}
		.grid {
			width: 100%;
			height: auto;
			border-radius: 8px;
		}

		.controls-panel {
			display: flex;
			justify-content: center;
			align-items: center;
			gap: 1rem;
			flex-wrap: wrap;
			margin-bottom: 1rem;
		}
		.controls-panel input {
			background: var(--dark-bg);
			border: 1px solid var(--border-color);
			border-radius: 8px;
			padding: 0.75rem;
			color: var(--text-color);
			font-family: 'Poppins', sans-serif;
			font-size: 1rem;
			width: 300px;
		}
		.control-btn {
			background-color: var(--primary-color);
			color: var(--dark-bg);
			border: none;
			padding: 0.75rem 2rem;
			border-radius: 50px;
			font-weight: 600;
			font-size: 1rem;
			cursor: pointer;
			transition: all 0.3s ease;
		}
		.control-btn:hover { transform: scale(1.05); }
		.control-btn:disabled { background-color: #4b5563; cursor: not-allowed; }

		.info-panel {
			display: flex;
			gap: 1rem;
			justify-content: center;
			margin-bottom: 1rem;
		}
		.info-box {
			background: var(--dark-bg);
			border: 1px solid var(--border-color);
			border-radius: 8px;
			padding: 0.5rem 1rem;
			font-size: 0.9rem;
		}
		.info-box span { font-weight: 600; color: var(--primary-color); }
		
		.note { font-size: 0.9rem; color: #9ca3af; margin-bottom: 1rem; }

		/* Legend */
		.legend {
			display: flex;
			justify-content: center;
			gap: 1.5rem;
			margin-top: 2rem;
		}
		.legend-item { display: flex; align-items: center; gap: 0.5rem; }
		.legend-color { width: 20px; height: 20px; border-radius: 4px; border: 1px solid var(--border-color); }
	</style>
</head>
<body>
	<div id="main-content">
		<div class="page-header">
			<a href="../stack.html" class="back-link"><h1 class="heading">Postfix Evaluation</h1></a>
		</div>
		<div class="canvas-container">
			<canvas class='grid' width='1000' height='400'></canvas>
		</div>
		<div class="info-panel">
			<div class="info-box">a = <span>1</span></div>
			<div class="info-box">b = <span>2</span></div>
		</div>
		<div class="controls-panel">
			<input class="number" id="expr-input" placeholder="Enter postfix expression (e.g., ab+ab/*)">
			<button class="control-btn evaluate">Evaluate</button>
		</div>
		<div class="note"><b>Note:</b> Expression can only contain a, b, /, *, +, -</div>
		<div class="legend">
			<div class="legend-item"><div class="legend-color" style="background-color: var(--scan-color);"></div><span>Scanning</span></div>
			<div class="legend-item"><div class="legend-color" style="background-color: var(--primary-color);"></div><span>Top of Stack</span></div>
		</div>
	</div>

	<script>
		// --- Main Setup ---
		let expressionArr = [];
		let stack = [];
		const TIME_DELAY = 800;
		
		const canvas = document.querySelector('canvas');
		const ctx = canvas.getContext("2d");
		
		const theme = {
			primary: getComputedStyle(document.documentElement).getPropertyValue('--primary-color').trim(),
			scan: getComputedStyle(document.documentElement).getPropertyValue('--scan-color').trim(),
			text: getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim(),
			dark: getComputedStyle(document.documentElement).getPropertyValue('--dark-bg').trim(),
			cardBg: '#374151',
		};

		// --- Drawing Functions ---
		function render(scanIndex = -1, operation = null) {
			ctx.clearRect(0, 0, canvas.width, canvas.height);
			drawExpressionArray(scanIndex);
			drawStack();
			if (operation) drawOperation(operation);
		}

		function drawExpressionArray(scanIndex) {
			const rect = { width: 60, height: 30 };
			expressionArr.forEach((val, i) => {
				ctx.fillStyle = (i === scanIndex) ? theme.scan : theme.cardBg;
				ctx.fillRect(i * rect.width + i*5 + 10, canvas.height / 2 - rect.height/2, rect.width, rect.height);
				
				ctx.fillStyle = (i === scanIndex) ? theme.dark : theme.text;
				ctx.font = '600 15px Poppins';
				ctx.textAlign = 'center';
				ctx.textBaseline = 'middle';
				ctx.fillText(val, i * rect.width + i*5 + 10 + rect.width/2, canvas.height / 2);
			});
		}

		function drawStack() {
			const stackWidth = 200;
			const stackX = canvas.width - stackWidth;
			const rectHeight = 30;

			ctx.strokeStyle = theme.primary;
			ctx.lineWidth = 3;
			ctx.strokeRect(stackX, 0, stackWidth, canvas.height);
			ctx.font = '700 18px Poppins';
			ctx.fillStyle = theme.primary;
			ctx.fillText("STACK", stackX + stackWidth / 2, canvas.height - 20);

			stack.forEach((val, i) => {
				const isTop = (i === stack.length - 1);
				const bgColor = isTop ? theme.primary : theme.text;
				
				const y = canvas.height - (i + 1) * rectHeight - (i * 5);
				ctx.fillStyle = bgColor;
				ctx.fillRect(stackX + 10, y, stackWidth - 20, rectHeight);
				
				ctx.fillStyle = theme.dark;
				ctx.font = '600 15px Poppins';
				ctx.fillText(val, stackX + stackWidth / 2, y + rectHeight / 2);
			});
		}

		function drawOperation(op) {
			ctx.font = "700 24px Poppins";
			ctx.fillStyle = theme.primary;
			ctx.textAlign = "center";
			ctx.fillText(op, canvas.width / 2 - 150, 80);
		}

		// --- Evaluation Logic ---
		async function evaluatePostfix(s) {
			const button = document.querySelector(".evaluate");
			button.disabled = true;
			
			expressionArr = s.split('');
			stack = [];
			render();
			await sleep(TIME_DELAY);

			for (let i = 0; i < s.length; i++) {
				const char = s[i];
				render(i);
				await sleep(TIME_DELAY);

				if (char === 'a' || char === 'b') {
					stack.push(char === 'a' ? 1 : 2);
					render(i);
				} else {
					if (stack.length < 2) {
						alert("Invalid Postfix Expression");
						button.disabled = false;
						return;
					}
					const operand2 = stack.pop();
					const operand1 = stack.pop();
					render(i, `${operand1} ${char} ${operand2}`);
					await sleep(TIME_DELAY * 1.5);
					
					let result;
					switch(char) {
						case '+': result = operand1 + operand2; break;
						case '-': result = operand1 - operand2; break;
						case '*': result = operand1 * operand2; break;
						case '/': result = operand1 / operand2; break;
					}
					stack.push(result);
					render(i, `= ${result}`);
				}
				await sleep(TIME_DELAY);
			}

			render(-1, `Final Result: ${stack[0]}`);
			button.disabled = false;
		}

		// --- Initialization and Helpers ---
		function addListeners() {
			document.querySelector(".evaluate").addEventListener("click", () => {
				const val = document.getElementById("expr-input").value.trim();
				const validChars = "ab/*+-";
				
				if (!val) {
					alert("Please enter an expression.");
					return;
				}
				for(let char of val) {
					if (!validChars.includes(char)) {
						alert(`Invalid character detected: '${char}'`);
						return;
					}
				}
				evaluatePostfix(val);
			});
		}

		function sleep(ms) {
			return new Promise(resolve => setTimeout(resolve, ms));
		}
		
		function init() {
			render();
			addListeners();
		}
		
		init();
	</script>
</body>
</html>
